<% layout("/layouts/boilerplate.ejs") %>

<div class="container my-5">
  <div class="row justify-content-center">
    <div class="col-lg-8">

      <!-- ================= TITLE ================= -->
      <h2 class="fw-bold mb-3"><%= listdata.title %></h2>

      <!-- ================= LISTING CARD ================= -->
      <div class="card border-0 shadow-lg rounded-4 overflow-hidden mb-5">

        <!-- Image -->
        <img
          src="<%= listdata.image %>"
          class="card-img-top"
          alt="hotel image"
          style="height: 350px; object-fit: cover;"
        />

        <div class="card-body p-4">

          <!-- Owner -->
          <p class="text-muted mb-2">
            Owned by
            <span class="fw-semibold text-dark">
              <%= listdata.owner.username %>
            </span>
          </p>

          <!-- Description -->
          <p class="text-muted mb-3">
            <%= listdata.description %>
          </p>

          <!-- Details -->
          <ul class="list-unstyled mb-4">
            <li class="mb-1">
              üí∞ <strong>‚Çπ<%= listdata.price.toLocaleString("en-IN") %></strong> / night
            </li>
            <li class="mb-1">
              üìç <%= listdata.location %>, <%= listdata.country %>
            </li>
          </ul>
          <!-- Booking Button -->
<div class="d-flex justify-content-end mb-4">
  <form action="/listing/<%= listdata._id %>/book" method="get">
    <button
      class="btn btn-success btn-lg rounded-pill px-5 shadow-sm fw-semibold"
    >
      üè® Book Now
    </button>
  </form>
</div>


          <!-- Owner Buttons -->
          <% if (curruser && curruser._id.equals(listdata.owner._id)) { %>
            <div class="d-flex gap-2">
              <a
                href="/listings/<%= listdata._id %>/edit"
                class="btn btn-outline-dark btn-sm rounded-pill px-4"
              >
                Edit
              </a>

              <form
                action="/listings/<%= listdata._id %>?_method=DELETE"
                method="post"
              >
                <button class="btn btn-dark btn-sm rounded-pill px-4">
                  Delete
                </button>
              </form>
            </div>
          <% } %>

        </div>
      </div>

      <!-- ================= REVIEW FORM ================= -->
      
        <hr class="my-5" />

        <h4 class="fw-semibold mb-4">Leave a review</h4>

        <form
          action="/listings/<%= listdata._id %>/review"
          method="post"
          novalidate
          class="p-4 border rounded-4 shadow-sm bg-light"
        >

          <!-- Rating -->
          <div class="mb-4">
            <label class="form-label fw-semibold">Rating</label>
            <div class="d-flex align-items-center gap-3">
              <span class="text-muted">1</span>
              <input
                type="range"
                min="1"
                max="5"
                name="review[rating]"
                class="form-range"
              />
              <span class="text-muted">5</span>
            </div>
          </div>

          <!-- Comment -->
          <div class="mb-4">
            <label class="form-label fw-semibold">Your Review</label>
            <textarea
              name="review[comment]"
              rows="4"
              class="form-control rounded-3"
              placeholder="Share your experience..."
              required
            ></textarea>
            <div class="invalid-feedback">
              Please write something!
            </div>
          </div>

          <button class="btn btn-dark rounded-pill px-4">
            Submit Review
          </button>
        </form>
      

      <!-- ================= ALL REVIEWS ================= -->
      <hr class="my-5" />

      <h4 class="fw-semibold mb-4">All Reviews</h4>

      <div class="row g-4">
        <% for (let review of listdata.reviews) { %>
          <div class="col-md-6">
            <div class="card border-0 shadow-sm h-100 rounded-4">
              <div class="card-body p-4">

                <!-- Username + Rating -->
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <h6 class="fw-semibold mb-0 text-primary">
                    @<%= review.author.username %>
                  </h6>
                  <span class="badge bg-warning text-dark rounded-pill">
                    ‚≠ê <%= review.rating %>/5
                  </span>
                </div>

                <!-- Comment -->
                <p class="text-muted mb-3">
                  <%= review.comment %>
                </p>

                <!-- Delete Review -->
                <% if (curruser && curruser._id.equals(review.author._id)) { %>
                  <form
                    action="/listings/<%= listdata._id %>/review/<%= review._id %>?_method=DELETE"
                    method="post"
                    class="text-end"
                  >
                    <button class="btn btn-sm btn-outline-danger rounded-pill px-3">
                      Delete
                    </button>
                  </form>
                <% } %>

              </div>
            </div>
          </div>
        <% } %>
      </div>

    </div>
  </div>
</div>

